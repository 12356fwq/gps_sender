<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GPS送信</title>
</head>
<body>
<h1>現在地を送信中…</h1>

<script>
    // URLパラメータから user_id と api_url を取得
    const params = new URLSearchParams(window.location.search);
    const user_id = params.get('user_id') || 0;
    const api_url = params.get('api_url') || 'http://172.16.105.162/gps_update/self_position.php'; // ← 自宅PCのIPに変更！

    // 位置情報取得
    if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
        pos => {
        const latitude = pos.coords.latitude;
        const longitude = pos.coords.longitude;

          // 送信
        fetch(api_url, {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify({
            user_id,
            latitude,
            longitude
            })
        })
        .then(res => {
            if (!res.ok) throw new Error('HTTPエラー');
            alert(`位置情報を送信しました（user_id=${user_id}）`);
        })
        .catch(err => {
            alert('位置情報の送信に失敗しました');
            console.error(err);
        });
        },
        err => {
        alert('位置情報取得に失敗しました');
        console.error(err);
        }
    );
    } else {
    alert('この端末では位置情報が取得できません');
    }
</script>
</body>
</html>

